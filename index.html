<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MyChat Service</title>
<style>
body{
  margin:0;
  font-family:sans-serif;
  display:flex;
  height:100vh;
  background:#f0f2f5;
}
#sidebar{
  width:250px;
  background:#111;
  color:white;
  display:flex;
  flex-direction:column;
}
#sidebar h2{
  text-align:center;
}
#groups{
  flex:1;
  overflow:auto;
}
.group{
  padding:10px;
  cursor:pointer;
}
.group:hover{
  background:#333;
}
#main{
  flex:1;
  display:flex;
  flex-direction:column;
}
#chat{
  flex:1;
  overflow:auto;
  padding:15px;
}
.message{
  margin:5px 0;
  padding:8px 12px;
  border-radius:10px;
  max-width:60%;
}
.me{
  background:#06c755;
  color:white;
  align-self:flex-end;
}
.other{
  background:#ddd;
}
#inputArea{
  display:flex;
  padding:10px;
  background:#ccc;
}
input{
  flex:1;
  padding:8px;
}
button{
  padding:8px;
}
.dark{
  background:#1e1e1e;
  color:white;
}
</style>
</head>
<body>

<div id="sidebar">
  <h2>MyChat</h2>
  <div id="userInfo"></div>
  <div id="groups"></div>
  <button onclick="createGroup()">ï¼‹ã‚°ãƒ«ãƒ¼ãƒ—</button>
  <button onclick="toggleDark()">ğŸŒ™</button>
</div>

<div id="main">
  <div id="chat"></div>
  <div id="inputArea">
    <input id="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
    <button onclick="send()">é€ä¿¡</button>
  </div>
</div>

<script>
let currentUser = localStorage.getItem("user");
let groups = JSON.parse(localStorage.getItem("groups")) || {};
let currentGroup = null;

if(!currentUser){
  currentUser = prompt("ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›");
  localStorage.setItem("user", currentUser);
}

document.getElementById("userInfo").innerText = "ğŸ‘¤ " + currentUser;

function save(){
  localStorage.setItem("groups", JSON.stringify(groups));
}

function renderGroups(){
  const g = document.getElementById("groups");
  g.innerHTML="";
  Object.keys(groups).forEach(name=>{
    const div=document.createElement("div");
    div.className="group";

    const messages = groups[name];
    const last = messages.length > 0 ? messages[messages.length-1].text : "";
    const unread = messages.filter(m=>!m.read && m.user!==currentUser).length;

    div.innerHTML = `
      <strong>${name}</strong><br>
      <small>${last}</small>
      ${unread>0 ? `<span style="color:red"> â—${unread}</span>` : ""}
    `;

    div.onclick=()=>openGroup(name);
    g.appendChild(div);
  });
}

function createGroup(){
  const name = prompt("ã‚°ãƒ«ãƒ¼ãƒ—å");
  if(!name) return;
  groups[name]=[];
  save();
  renderGroups();
}

function openGroup(name){
  currentGroup=name;

  // é–‹ã„ãŸã‚‰æ—¢èª­ã«ã™ã‚‹
  groups[name].forEach(m=>{
    if(m.user!==currentUser){
      m.read=true;
    }
  });

  save();
  renderChat();
  renderGroups();
}

function renderChat(){
  const chat=document.getElementById("chat");
  chat.innerHTML="";
  if(!currentGroup) return;

  groups[currentGroup].forEach(m=>{
    const div=document.createElement("div");
    div.className="message "+(m.user===currentUser?"me":"other");
    div.innerHTML = `
      ${m.user}: ${m.text}
      ${m.user===currentUser ? `<br><small>${m.read?"æ—¢èª­":"æœªèª­"}</small>`:""}
    `;
    chat.appendChild(div);
  });

  chat.scrollTop = chat.scrollHeight;
}

function send(){
  if(!currentGroup) return;
  const text=document.getElementById("text").value;
  if(!text) return;

  groups[currentGroup].push({
    user:currentUser,
    text:text,
    read:false
  });

  save();
  renderChat();
  renderGroups();
  document.getElementById("text").value="";
}

document.getElementById("text").addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    send();
  }
});

function toggleDark(){
  document.body.classList.toggle("dark");
}

renderGroups();
</script>


</body>
</html>
